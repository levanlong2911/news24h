---
const { position }: { position: 'top' | 'middle' | 'bottom' } = Astro.props;

let ads: string[] = [];

try {
  const res = await fetch(`https://lifennew.com/api/ads?position=${position}`);
  const text = await res.text();

  try {
    const json = JSON.parse(text);
    ads = json.data.map((item: any) => item.script);
  } catch (jsonError) {
    console.error('⚠️ JSON parse error. Raw response:\n', text);
    throw jsonError;
  }
} catch (error) {
  console.error('❌ Failed to load ads:', error);
}
---

{ads.length > 0 && ads.map((ad, index) => (
  <div class="ad-container" set:html={ad} />
))}
