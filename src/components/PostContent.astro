---
import { parseHTML } from "linkedom";
import type { AdItem } from "../types/ads";
import { applyAdsInPost } from "./ads/adsInPostEngine";

const {
  html,
  inPostAds = []
} = Astro.props as {
  html: string;
  inPostAds: AdItem[];
};

const { document } = parseHTML(`<body>${html}</body>`);

/* =========================
   SANITIZE – KHÔNG CHÈN ADS
   TRONG TABLE / LIST
========================= */
document.querySelectorAll(`
  table iframe,
  table script,
  table ins,
  ul iframe,
  ol iframe,
  blockquote iframe
`).forEach(el => el.remove());

/* =========================
   APPLY IN-POST ENGINE
========================= */
applyAdsInPost(document, inPostAds);

const output =
  document.body?.innerHTML ||
  document.documentElement?.innerHTML ||
  html;
---

<div class="table-wrapper post-content" set:html={output} />
