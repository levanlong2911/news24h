---
import type { Post } from '../types.ts';

const { posts = [] }: { posts?: Post[] } = Astro.props;

// ✅ Guard an toàn – không render nếu không có dữ liệu
if (!Array.isArray(posts) || posts.length === 0) {
  return null;
}
const BASE_URL = import.meta.env.PUBLIC_API_WEB || "";
---

<section id="silebar">
  <h3 class="list-post">POST NEW</h3>

  <ul>
    {
      posts.slice(0, 5).map((post) => {
        // ✅ Fallback an toàn
        const slug = post.slug ?? '';
        const title = post.title ?? 'Untitled';
        const thumbnail =
          post.thumbnail ||
          '${BASE_URL}/default.jpg';

        // ❗ Không có slug thì bỏ qua (tránh link lỗi / 302 / 404)
        if (!slug) return null;

        return (
          <li key={post.id}>
            <div class="list-img">
              <a href={`/post/${slug}`} title={title}>
                <img
                  src={thumbnail}
                  alt={title}
                />
                <h4 class="post-title">{title}</h4>
              </a>
            </div>
          </li>
        );
      })
    }
  </ul>
</section>
