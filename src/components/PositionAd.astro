---
import type { AdsMap } from "../types/ads";

const { position, ads } = Astro.props as {
  position: keyof AdsMap;
  ads: AdsMap;
};

const items =
  Array.isArray(ads?.[position])
    ? ads[position].filter(
        (a) =>
          typeof a.script === "string" &&
          a.script.includes("<script")
      )
    : [];
---

{items.length > 0 && (
  <div
    class={`ad ad-${position}`}
    data-ad-script={encodeURIComponent(items[0].script)}
  />
)}

<script is:client="load">
  import { injectAdScript } from "../lib/injectAdScript";

  document
    .querySelectorAll(".ad[data-ad-script]")
    .forEach((el) => {
      const raw = decodeURIComponent(el.dataset.adScript || "");
      el.innerHTML = "";
      injectAdScript(el, raw);
    });
</script>
