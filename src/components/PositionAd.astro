---
import type { AdsMap } from "../types/ads";

const { position, ads } = Astro.props as {
  position: keyof AdsMap;
  ads: AdsMap;
};

const items =
  Array.isArray(ads[position])
    ? ads[position].filter(
        a => typeof a.script === "string" && a.script.trim().length > 0
      )
    : [];
---

{items.length > 0 && (
  <div class={`ad ad-${position}`}>
    {items.map(item => (
      <div data-ad-script={encodeURIComponent(item.script)} />
    ))}
  </div>
)}

<script is:client="load">
  document
    .querySelectorAll(".ad [data-ad-script]")
    .forEach(el => {
      const raw = decodeURIComponent(el.dataset.adScript || "");
      const wrapper = document.createElement("div");
      wrapper.innerHTML = raw;
      el.innerHTML = "";
      while (wrapper.firstChild) {
        el.appendChild(wrapper.firstChild);
      }
    });
</script>
