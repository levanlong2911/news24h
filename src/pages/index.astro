---
import BaseLayout from '../layouts/BaseLayout.astro';
import Content from '../components/Content.astro';
import Sidebar from '../components/Sidebar.astro';
import { fetchPosts, fetchAds } from '../lib/api';
import type { Post } from '../types';

// Fallback
const emptyList: Post[] = [];
let posts: Post[] = emptyList;
let ads: any = {};

try {
  const result = await Promise.allSettled([
    fetchPosts(1, 'v1'),
    fetchAds(),
  ]);

  // posts
  if (
    result[0].status === 'fulfilled' &&
    result[0].value &&
    Array.isArray(result[0].value.items)
  ) {
    posts = result[0].value.items;
  }

  // ads
  if (result[1].status === 'fulfilled') {
    ads = result[1].value || {};
  }
} catch {
  // ❗ tuyệt đối không throw
}

const pageTitle = 'Home';
---

<BaseLayout pageTitle={pageTitle} ads={ads}>
	<div class="grid-container">
		<Content posts={posts} />
		<Sidebar posts={posts} />
	</div>
</BaseLayout>
